<html>
<head>
  <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='GMstyle.css') }}">
  <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='plots.css') }}">

  <!-- Plotly.js -->
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script src= "http://code.jquery.com/jquery-latest.min.js"></script>
</head>

<body>
  <div id="header">
    <div id="img_container">
        <img src="http://www.genesismedia.com/wp-content/themes/genesis/images/logo.svg" onerror="this.onerror=null; this.src='http://www.genesismedia.com/wp-content/themes/genesis/images/logo.png'" style="margin: 35px; width: 400px; height: 90px;">
        <button type="button" id="btn" onclick="submitForm()">Simulate</button>
    </div>
    <h1>SIMULATED BIG SWING MODEL</h1>
  </div>



  <!-- Take rewards associated with reactions to actions as inputs-->
  <br><br>
  <button id="update_reward_button">Add Action/Rewards</button>
  <table id= "rewards" class="display" cellspacing="0" width="100%">
      <tr>
        <td><strong>Actions/Reactions</strong></td>
        <td><strong>down ($ Increase in time spent)</strong></td>
        <td><strong>right ($ Increase in #pageviews)<strong></td>
        <td><strong>dead ($ User left)<strong></td>
        <td><strong>Use rate<strong></td>
      </tr>
      <tr class="inputs">
        <td class="action"><input type="text" value="Nothing"></td>
        <td class="down"><input type="number" value="2"></td>
        <td class="right"><input type="number" value="2"></td>
        <td class="dead"><input type="number" value="2"></td>
        <td class="use_rate"><input type="number" value="0.6"></td>
      </tr>
  </table>

  <br><br>ALPHA:
  <input type="number" class="vars" name="ALPHA" value=0.5>
  &ensp; GAMMA:
  <input type="number" class="vars" name="GAMMA" value=0.5>
    &ensp;MAX_ATSOP_ROWS:
  <input type="number" class="vars" name="MAX_ATSOP_ROWS" value=10>
  &ensp; MAX_SD_COLS:
  <input type="number" class="vars" name="MAX_SD_COLS" value=5>
  &ensp; ATSOP_GAP(seconds):
  <input type="number" class="vars" name="ATSOP_GAP" value=5>

<hr>
  <div id="Q" class="results">
    <h3>Q-Actions</h3>
  <!-- Plotly chart will be drawn inside this DIV -->
  <div id="QDiv0" class="Q" style="width:480px; height:400px;"></div>
  <div id="QDiv1" class="Q" style="width:480px; height:400px;"></div>
  <div id="QDiv2" class="Q" style="width:480px; height:400px;"></div>
  </div>

  <div id="others" class="results">
    <div id="optimum" class="minions">
      <h3>Optimal policy</h3>
    <div>
    <div id="value" class= "minions">
      <h3>Value Matrix</h3>
    </div>
  </div>

</body>

<!-- setting up inputs -->
  <script>
    $(document).ready(function() {
      var table = $('rewards')
      var max_fields = 3;
      var wrapper = $("#rewards");
      var add_button = $("#update_reward_button");

      new_row = '<tr class="inputs"> \
                    <td class="action"> <input type="text" name="mytext[]"  placeholder="Enter Action"/> </td> \
                    <td class="down"><input type="number" value = "2"></td> \
                    <td class="right"><input type="number" value = "2" ></td> \
                    <td class="dead"><input type="number" value = "2" ></td> \
                    <td class="use_rate"><input type="number" value="0.2"></td> \
                    <td><input type="button" value="Remove Action"></td> \
                  </tr>';

      var x = 1;
      $(add_button).click(function(e) {
        e.preventDefault();
        if(x < max_fields){
          x++;
          $(wrapper).append(new_row);
        }
      });

      $('#rewards').on("click",'input[type="button"]', function(e){
        $(this).closest('tr').remove();
        x--;
      })
    });


  </script>

  <!-- submitting forms -->
 <script>
   function submitForm(){


     var inputs = $('.inputs')
     var out ={action:{},params:{}};
     $.each(inputs, function(t){
       action = $(inputs[t]).find('.action > input')[0].value;
       down = $(inputs[t]).find('.down > input')[0].value;
       dead = $(inputs[t]).find('.dead > input')[0].value;
       right = $(inputs[t]).find('.right > input')[0].value;
       use_rate = $(inputs[t]).find('.use_rate > input')[0].value;
       out.action[action] = {'dead':dead, 'down':down, 'right':right, 'use_rate':use_rate}
     });

     vars=  $('.vars')
     $.each(vars, function(t){
       out.params[vars[t].name] = vars[t].value;
     })

     $.ajax({
       url:"http://0.0.0.0:9090/loadSetup",
       type: "POST",
       data:JSON.stringify(out),

       contentType:"application/json",
       success:function(response) {
        //  var newWindow =  window.open("", "_blank");
        //  newWindow.location.href=response;
        updatePlots()
       }
     });
   }

 </script>

 <script type="text/javascript"  src="{{ url_for('static', filename='makePlots.js') }}"></script>


</html>
